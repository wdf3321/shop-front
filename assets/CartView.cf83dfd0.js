import{u as B,ac as N,a as S,m as f,aG as $,S as x,o as i,c as u,b as a,w as n,V as R,d as p,e as C,h as t,R as D,aH as I,aI as T,af as c,$ as k,i as d,j as o,aJ as j,ag as z}from"./index.3781e4fd.js";import{V as A}from"./VTable.c9c370be.js";const E={id:"cart"},F=t("h1",{class:"text-center"},"\u8CFC\u7269\u8ECA",-1),G=t("thead",null,[t("tr",null,[t("th",null,"\u5716\u7247"),t("th",null,"\u540D\u7A31"),t("th",null,"\u55AE\u50F9"),t("th",null,"\u6578\u91CF"),t("th",null,"\u5C0F\u8A08"),t("th",null,"\u64CD\u4F5C")])],-1),H={key:0},J=t("td",{class:"text-center",colspan:"6"},"\u6C92\u6709\u5546\u54C1",-1),L=[J],M={__name:"CartView",setup(P){const y=B(),V=N(),{editCart:g,checkout:w}=V,l=S([]),_=async(e,r)=>{await g({_id:l[e].p_id._id,quantity:r}),l[e].quantity+=r,l[e].quantity<=0&&l.splice(e,1)},b=async()=>{await w(),y.push("/orders")},v=f(()=>l.reduce((e,r)=>e+r.p_id.price*r.quantity,0)),q=f(()=>l.length>0&&!l.some(e=>!e.p_id.sell));return(async()=>{try{const{data:e}=await $.get("/users/cart");l.push(...e.result)}catch{x.fire({icon:"error",title:"\u5931\u6557",text:"\u53D6\u5F97\u8CFC\u7269\u8ECA\u5931\u6557"})}})(),(e,r)=>(i(),u("div",E,[a(R,null,{default:n(()=>[a(p,{cols:"12"},{default:n(()=>[F]),_:1}),a(C),a(p,{cols:"12"},{default:n(()=>[a(A,null,{default:n(()=>[G,t("tbody",null,[(i(!0),u(D,null,I(l,(s,h)=>(i(),u("tr",{key:s._id,class:j({"bg-red":!s.p_id.sell})},[t("td",null,[a(z,{"aspect-ratio":1,width:200,src:s.p_id.image},null,8,["src"])]),t("td",null,c(s.p_id.name),1),t("td",null,c(s.p_id.price),1),t("td",null,[a(d,{color:"primary",onClick:m=>_(h,-1)},{default:n(()=>[o("-")]),_:2},1032,["onClick"]),o("\xA0"+c(s.quantity)+"\xA0",1),a(d,{color:"primary",onClick:m=>_(h,1)},{default:n(()=>[o("+")]),_:2},1032,["onClick"])]),t("td",null,c(s.quantity*s.p_id.price),1),t("td",null,[a(d,{color:"red",onClick:m=>_(h,s.quantity*-1)},{default:n(()=>[o("\u522A\u9664")]),_:2},1032,["onClick"])])],2))),128)),l.length===0?(i(),u("tr",H,L)):T("",!0)])]),_:1})]),_:1}),a(C),a(p,{class:"text-center",cols:"12"},{default:n(()=>[t("p",null,"\u7E3D\u91D1\u984D "+c(k(v)),1),a(d,{color:"green",disabled:!k(q),onClick:b},{default:n(()=>[o("\u7D50\u5E33")]),_:1},8,["disabled"])]),_:1})]),_:1})]))}};export{M as default};
